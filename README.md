# 비정상 거래 탐지 모델 개발

이 프로젝트는 금융 거래 데이터에서 비정상 거래(매입 취소)를 탐지하기 위한 머신러닝 모델을 개발합니다.

## 파일 설명

1. `preprocessing.ipynb`: 데이터 전처리 과정을 담은 Jupyter Notebook
2. `main_private.py`: 개인 거래 별 학습 및 평가를 위한 메인 실행 파일
3. `main_each_pran_ml.py`: 업태 내 거래 별 학습 및 평가를 위한 실행 파일
4. `main_each_name_ml.py`: 가맹점 내 거래 별 학습 및 평가를 위한 실행 파일

## 목차

1. 데이터 전처리
2. 대표 업태 및 가맹점 아이디 선정
3. 시각화
4. 매입 취소 탐지 모델
5. 결론

## 1. 데이터 전처리

### 1.1. 데이터 형태
- 총 데이터: 3,785,142건
- 총 변수: 27가지
- 매입취소(거래상태): 20,888건

### 1.2. 전처리 과정
1. 개인정보 삭제
2. 업종 & 업태 NAN 처리
3. 업종/업태 정보 상호 보완
4. 가맹점 지역 주소 기준 좌표값(lat, long) 추가
5. '거래상태'열 '승인' 및 '승인취소' 삭제
6. 정상/비정상 라벨링
7. 업태 통일화를 위한 수기 재분류
8. 결제 통화 통일화(원화 환산)

### 1.3. 전처리 후 데이터
- 총 데이터: 2,415,101건
- 총 변수: 27가지

## 2. 대표 업태 및 가맹점 아이디 선정

### 2.1. 업태 선정
- 도소매 (1,330,180 정상 / 3,453 비정상)
- 서비스 (842,024 / 2,331)
- 통신업 (83,974 / 29)
- General e_comm (3,136 / 21)

### 2.2. 가맹점 아이디 선정
- nfgZ69lWmQ== (658,573 / 98)
- di7FqMsiZ4d+0dQ= (494,529 / 498)
- /KMJNdw= (183,608 / 620)
- lrWX+FgZzQ== (121,984 / 687)

## 3. 시각화

금액 분포를 확인하기 위해 개별 거래, 업태 그룹별, 가맹점 그룹별 시각화 수행 (amount < 90,000 필터 적용)

## 4. 매입 취소 탐지 모델

### 4.1. 분석 모델 선정
- Random Forest
- XGBoost

### 4.2. 데이터 샘플링
- 정상 거래건 50% 랜덤 샘플링
- train:validation:test = 3:1:1 비율 분할

### 4.3. 최종 feature 선정
- 원화환산금액
- 고객 카드번호 암호화값
- 가맹점아이디
- new_업태
- 시스템 등록일시
- label

### 4.4. 실험 결과
- 개별 거래 분류 모델: Random Forest (acc: 0.994, F1: 0.1865)
- 업태 그룹별 모델: 도소매 (RF acc: 0.9916, F1: 0.1382)
- 가맹점 그룹별 모델: di7FqMsiZ4d+0dQ= (RF acc: 0.9978, F1: 0.2128)

## 5. 결론
- Random Forest가 가장 좋은 성능을 보임
- 데이터 불균형이 큰 상황에서도 높은 정확도 유지
- 비정상 거래 탐지 성능 향상을 위해 추가적인 feature engineering과 데이터 증강 필요
- 실제 Fraud 거래에 대한 명확한 label이 있다면 더 정확한 FDS 모델 개발 가능

## 실행 방법

1. 전처리:
```bash
jupyter notebook preprocessing.ipynb

2. 모델 실행:
```bash
# 개인 거래 별 모델
python main_private.py

# 업태 별 모델
python main_each_pran_ml.py

# 가맹점 별 모델
python main_each_name_ml.py
